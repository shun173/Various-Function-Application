{% extends 'base.html' %}
{% load humanize %}

{% block content %}

<div class="product-detail">
    <div class="product-detail-image">
        <img src="{{ product.image.url }}" alt="" class="product-img">
    </div>

    <div class="product-detail-info">
        <h2>{{ product.name }}</h2>
        <p>出品者：　<a href="{% url 'users:user_detail' product.owner.id %}">{{ product.owner.username }}</a></p>
        <hr>
        <div class="point-fav-section">
            <h4>{{ product.price | intcomma }}ポイント</h4>
            {% if request.user.is_authenticated %}
            <form action="{% url 'ecapp:toggele_fav_product_status' %}" method="post">{% csrf_token %}
                <input type="hidden" name="product_id" value="{{ product.id }}">
                {% if product in request.user.fav_products.all %}
                <input type="submit" name="submit" class="fav_button" value="お気に入りから外す">
                {% else %}
                <input type="submit" name="submit" class="fav_button" value="お気に入りに入れる">
                {% endif %}
            </form>
            {% endif %}
        </div>
        <p>{{ product.description }}</p>

        <div>
            {% if request.user.is_authenticated %}
            <form action="{% url 'ecapp:detail' product.id %}" method="post">{% csrf_token %}
                {{ add_to_cart_form.as_p }}
                <button type="submit" class="purchase-button">カートに追加する</button>
            </form>
            {% else %}
            <a href="{% url 'users:login' %}?next={{ request.path }}">
                <button class="purchase-button">ログインして購入する</button>
            </a>
            {% endif %}
        </div>
    </div>
</div>
<div>
    <h2>記事一覧</h2>
    {% for article in product.article_set.all %}
    <div>
        <div>
            <p>{{ article.content }}</p>
        </div>
        <div>
            <span>{{ article.created_at }}</span>
            <span>good{{ article.good_count }}コ</span>
            <span>by {{ article.author.username }}</span>
            <form action="" method="post">{% csrf_token %}
                <input type="submit" name="good" value="good">
            </form>
        </div>
    </div>
    {% endfor %}
</div>

{% endblock %}